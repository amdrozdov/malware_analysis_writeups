# Lab 6-1 Analysis
### Virus Total Search
**Name**: Trojan:Win32/Generic.78682e8f

**Compiler**: `Compiler: EP:Microsoft Visual C/C++(6.0 (1720-9782))[EXE32]`

### Major code construction in main()
2 Answers for this question:
According to disassembler in my PC - one/first of the subroutines is
```asm
.text:00401040 sub_401040      proc near               ; CODE XREF: start+AF↓p
.text:00401040
.text:00401040 var_4           = dword ptr -4
.text:00401040
.text:00401040                 push    ebp
.text:00401041                 mov     ebp, esp
.text:00401043                 push    ecx
.text:00401044                 call    sub_401000
.text:00401049                 mov     [ebp+var_4], eax
.text:0040104C                 cmp     [ebp+var_4], 0
.text:00401050                 jnz     short loc_401056
.text:00401052                 xor     eax, eax
.text:00401054                 jmp     short loc_40105B
```
And the construction is `cmp->jnz` - it's if statement. But accoring to the book answer it happens in sub_401000 - if statement as well. Maybe it depends on disassmbler version.

### Subroutine 0x40105F
In my version of IDA it will not show the name of the function, but we can find cross ref here:
```asm
.text:00401000 sub_401000      proc near               ; CODE XREF: sub_401040+4↓p
.text:00401000
.text:00401000 var_4           = dword ptr -4
.text:00401000
.text:00401000                 push    ebp
.text:00401001                 mov     ebp, esp
.text:00401003                 push    ecx
.text:00401004                 push    0               ; dwReserved
.text:00401006                 push    0               ; lpdwFlags
.text:00401008                 call    ds:InternetGetConnectedState
.text:0040100E                 mov     [ebp+var_4], eax
.text:00401011                 cmp     [ebp+var_4], 0
.text:00401015                 jz      short loc_40102B
.text:00401017                 push    offset aSuccessInterne ; "Success: Internet Connection\n"
.text:0040101C                 call    sub_40105F
.text:00401021                 add     esp, 4
.text:00401024                 mov     eax, 1
.text:00401029                 jmp     short loc_40103A
```

It looks like `sub_40105F("Success: Internet Connection\n");` - is it a printf?
### Purpose of this program?
First quick analysis will check the events:
```
GetVersion()
call sub.KERNEL32.dll_HeapCreate_580
text:00401104                 call    ds:GetCommandLineA
text:00402137                 mov     ebp, ds:GetEnvironmentStringsW
call    ds:GetModuleFileNameA
call    ds:InternetGetConnectedState
```

First activity is internet check:
```asm
sub_401000      proc near               ; CODE XREF: connect_check+4↓p
.text:00401000
.text:00401000 var_4           = dword ptr -4
.text:00401000
.text:00401000                 push    ebp
.text:00401001                 mov     ebp, esp
.text:00401003                 push    ecx
.text:00401004                 push    0               ; dwReserved
.text:00401006                 push    0               ; lpdwFlags
.text:00401008                 call    ds:InternetGetConnectedState
.text:0040100E                 mov     [ebp+var_4], eax
.text:00401011                 cmp     [ebp+var_4], 0
.text:00401015                 jz      short loc_40102B
.text:00401017                 push    offset aSuccessInterne ; "Success: Internet Connection\n"
.text:0040101C                 call    sub_40105F
.text:00401021                 add     esp, 4
.text:00401024                 mov     eax, 1
.text:00401029                 jmp     short loc_40103A
.text:0040102B ; ---------------------------------------------------------------------------
.text:0040102B
.text:0040102B loc_40102B:                             ; CODE XREF: sub_401000+15↑j
.text:0040102B                 push    offset aError11NoInter ; "Error 1.1: No Internet\n"
.text:00401030                 call    sub_40105F
.text:00401035                 add     esp, 4
.text:00401038                 xor     eax, eax
.text:0040103A
.text:0040103A loc_40103A:                             ; CODE XREF: sub_401000+29↑j
.text:0040103A                 mov     esp, ebp
.text:0040103C                 pop     ebp
.text:0040103D                 retn
.text:0040103D sub_401000      endp
```

It will print `Success: Internet Connection` or `Error 1.1: No Internet` and then it will call `ExitProcess()`

**Total score**: 10/10
